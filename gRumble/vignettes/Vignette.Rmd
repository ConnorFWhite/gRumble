---
title: "Introduction to gRumble"
author: "MBayOtolith <jmoxley@mbayaq.org>"
date: "May 2017"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to gRumble}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The gRumble package contains functions for the post-processing of sensor data returned from animal-borne motion detecting data loggers (a.k.a., inertial monitoring units or IMUs, for short) with shifting orientations during deployment. 


Inertial measurement data (e.g., accelerometry, magnetometry, etc.) from such data loggers are transforming quantitative understanding of animal behavior, but requires significant and careful handling to translate high-resolution data streams into interpretible behavior.  One primary post-processing task is repositioning the tri-axial sensor data so that measurements correspond to the body posture of the animal.  Aligningment of the data to the animal's frame of reference is accomplished by resolving the static acceleration signal of gravity and/or aligning dynamic acceleration signals to known (and ideally repetetive) behaviors.  


Here we present a dynamic approach to transforming raw IMU data in order to align signals with the body axes of a tagged animal, in this case sharks carrying unfixed stomach-borne IMUs fed to them during research.  This approach builds on methods described in [Jorgensen et al. 2015] (https://animalbiotelemetry.biomedcentral.com/articles/10.1186/s40317-015-0071-6), but importantly uses a dyanmic moving window instead of a discrete window that allows for continuous correction and accounting for stomach movement.  

## History of gRumble package

Connor is a badass, and just straight coded up this fine piece of programming in 2017.  But it builds off the slick methods outlined in Jorgensen et al. 2015.  

## Model overview
The correction procedure follows four primary steps, three of are enacted via custom functions: 

1. find

Notes about data preparation and smoothing pre-processing are discussed in a separate section below.  In our example, the procedure relies on assumptions that the shark's body posture is horizontal or prone during periods when the vertical velocity (or depth rate) is near zero.  When adapting to other species, care should be taken in tailoring this assumption to appropriate behaviors for that animal.  

identify the appropriate behavior for defining events when the tag's position is assumed to be known and level. 


have their own custom function designed for the specific procedure.   

4 steps
1-calc breaks in VV
2-estimate angles
3-test for forward-facing/rear-facing orientation
4-backfill angles to recover original data resolution

notes on data pre-processing.. smoothing, etc. 
where to put figures?

## findBreaks()
This method depends on the ability to identify moments of prone/horizontal posture when a properly-oriented tag will record static acceleration along a single axis.  For a swimming animal like a shark, this is determined by the animal's vertical velocity or depth rate as it is recorded by the depth sensor.  

  For a swimming animal like a shark, this is  
The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## Angle calculation
Description of EstAngs()

##Correction for anterior/posterior 

##Backfill angInterp()

##apply corrections rotAngle()

##notes on data/animal, data formats, and pre-processing
-designed around procedures needed in shark research, applicable other creatures
-test data is XX hours from a research shark
-dependencies
-smoothing & filtering, and defining the depth rate

##tidbits about code
You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
